# -*- coding: utf-8 -*-
"""002_Read_Label_Data.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1G3DZZRtTRNBig7cMJY_y9LCJxxrMgxTx
"""

# Mount Google Drive
from google.colab import drive
drive.mount('/content/gdrive')

# Import Libraries
import os
import pandas as pd
import numpy as np
import time
import datetime
pd.options.mode.chained_assignment = None
print("Libraries are Imported")

# Define Path of Label Data
path = '/content/gdrive/MyDrive/Data/Geolife/Label'
os.chdir(path)

# Read Label Data
df_list = os.listdir()
df = []
for i in df_list:
    with open(f'{i}', 'rb') as f:
        df.append(f.readlines())

# Keep only the digits
mm = []
for i in range(len(df_list)):
    txt = df_list[i]
    User = ''.join((ch if ch in '0123456789' else '') for ch in txt)
    mm.append(User)

# Define User List
User_list = []
for i in mm:
    User_list.append(int(i))

# Read Start - End - Mode - User from Label Data
Start = []
End = []
Mode = []
User = []

for i in range(len(df)):
    del df[i][0]
    for j in range(len(df[i])):
        line = str(df[i][j]).split("\n")[0]
        St = line.split("\\t")[0].split("'")[1]
        En = line.split("\\t")[1]
        Mo = line.split("\\t")[2].split("\\r")[0]
        Start.append(St)
        End.append(En)
        Mode.append(Mo)
        User.append(User_list[i])

# Make DataFrame
Data = {'Start':Start, 'End':End, 'Mode':Mode, 'User':User}
DD = pd.DataFrame(Data)

# Change Date and Time of Start to Timestamp
ST = []
for i in DD['Start']:
    element = datetime.datetime.strptime(i,"%Y/%m/%d %H:%M:%S")
    ST.append(datetime.datetime.timestamp(element))

# Change Date and Time of End to Timestamp
En = []
for i in DD['End']:
    element = datetime.datetime.strptime(i,"%Y/%m/%d %H:%M:%S")
    En.append(datetime.datetime.timestamp(element))

DD['Start_TS'] = ST
DD['End_TS'] = En

DD.head()

# Define Path for Pickle Data
path = "/content/gdrive/MyDrive/Colab Notebooks/"
os.chdir(path)

import pickle
with open("002_All_GeoLife_Label.pickle", 'wb') as f:
    pickle.dump(DD, f)

import datetime

# Example value of TS
ts_value = 1.191859e+09

# Convert to a datetime object
dt_object = datetime.datetime.fromtimestamp(ts_value)
print("Datetime:", dt_object)
